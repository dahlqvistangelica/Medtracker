<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Medtracker.Pages.ShowMedicationPage"
             x:Name="MedicationsPage"
             Shell.NavBarIsVisible="False"
             BackgroundColor="#F9FAFB">
    <Grid RowDefinitions="Auto, *">

        <HorizontalStackLayout Grid.Row="0" Padding="24,20" Spacing="15">
            <Border StrokeShape="RoundRectangle 10" BackgroundColor="White" Stroke="#E5E7EB" HeightRequest="40" WidthRequest="40">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding Source={x:Reference MedicationsPage}, Path=BindingContext.GoBackCommand}"/>
                </Border.GestureRecognizers>
                <Label Text="â¬…" VerticalOptions="Center" HorizontalOptions="Center" TextColor="#374151"/>
            </Border>

            <VerticalStackLayout VerticalOptions="Center">
                <Label Text="Mina mediciner" 
                       FontSize="20" 
                       FontAttributes="Bold" 
                       TextColor="#1E3A8A"/>
                <HorizontalStackLayout Spacing="5">
                    <Label Text="{Binding MedicationsList.Count}" TextColor="#4B5563" FontSize="14"/>
                    <Label Text="mediciner" TextColor="#4B5563" FontSize="14"/>
                </HorizontalStackLayout>
            </VerticalStackLayout>
        </HorizontalStackLayout>

        <CollectionView Grid.Row="1"
                        ItemsSource="{Binding MedicationsList}"
                        Margin="24,0">

            <CollectionView.ItemsLayout>
                <LinearItemsLayout Orientation="Vertical" ItemSpacing="12"/>
            </CollectionView.ItemsLayout>

            <CollectionView.EmptyView>
                <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center" Spacing="10" Margin="0,50,0,0">
                    <Label Text="ðŸ’Š" FontSize="60" TextColor="#D1D5DB" HorizontalOptions="Center"/>
                    <Label Text="Inga mediciner registrerade" TextColor="#6B7280" FontSize="16" HorizontalOptions="Center"/>
                    <Label Text="LÃ¤gg till din fÃ¶rsta medicin" TextColor="#9CA3AF" FontSize="14" HorizontalOptions="Center"/>
                </VerticalStackLayout>
            </CollectionView.EmptyView>

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border StrokeShape="RoundRectangle 12"
                            Stroke="#E5E7EB"
                            StrokeThickness="1"
                            BackgroundColor="White"
                            Padding="16"
                            Margin="0,0,0,5">

                        <Border.Shadow>
                            <Shadow Brush="Black" Offset="0,1" Radius="2" Opacity="0.05"/>
                        </Border.Shadow>

                        <Grid RowDefinitions="Auto, Auto, Auto">

                            <Grid ColumnDefinitions="Auto, *, Auto" Grid.Row="0" Margin="0,0,0,4">
                                <Label Grid.Column="0" 
                                       Text="ðŸ’Š" 
                                       FontSize="16" 
                                       TextColor="#2563EB" 
                                       VerticalOptions="Center"
                                       Margin="0,0,8,0"/>

                                <Label Grid.Column="1" 
                                       Text="{Binding Name}" 
                                       FontSize="16" 
                                       FontAttributes="Bold"
                                       TextColor="#1E3A8A" 
                                       VerticalOptions="Center"/>

                                <Button Grid.Column="2"
                                        Text="âœï¸"
                                        FontSize="12"
                                        TextColor="#2563EB"
                                        BackgroundColor="#EFF6FF" 
                                        CornerRadius="8"
                                        HeightRequest="36"
                                        WidthRequest="36"
                                        Padding="0"
                                        Command="{Binding Source={x:Reference MedicationsPage}, Path=BindingContext.GoToEditCommand}"
                                        CommandParameter="{Binding MedID}"/>
                            </Grid>

                            <VerticalStackLayout Grid.Row="1" Spacing="2" Margin="0,0,0,12">
                                <HorizontalStackLayout Spacing="5">
                                    <Label Text="{Binding medicationType}" FontSize="13" TextColor="#4B5563"/>
                                    <Label Text="â€¢" TextColor="#4B5563"/>
                                    <Label Text="{Binding Strength}" FontSize="13" TextColor="#4B5563"/>
                                </HorizontalStackLayout>

                                <Label Text="{Binding Dosage, StringFormat='Dosering: {0} per dag'}" 
                                       FontSize="13" 
                                       TextColor="#4B5563"/>
                            </VerticalStackLayout>

                            <Grid Grid.Row="2" ColumnDefinitions="*, Auto" Padding="0,12,0,0">
                                <BoxView Color="#F3F4F6" HeightRequest="1" VerticalOptions="Start" Grid.ColumnSpan="2" Margin="-16,0,-16,0"/>

                                <HorizontalStackLayout Grid.Column="0" Spacing="6" VerticalOptions="Center" Margin="0,8,0,0">
                                    <Label Text="ðŸ“…" FontSize="14" TextColor="#4B5563"/>
                                    <Label Text="{Binding PrescriptionCollected, StringFormat='UthÃ¤mtad: {0:yyyy-MM-dd}'}" 
                                           FontSize="12" 
                                           TextColor="#4B5563"
                                           VerticalOptions="Center"/>
                                </HorizontalStackLayout>

                                <Border Grid.Column="1" 
                                        StrokeShape="RoundRectangle 8"
                                        StrokeThickness="1"
                                        BackgroundColor="#DCFCE7" 
                                        Stroke="#BBF7D0" 
                                        Padding="8,4"
                                        VerticalOptions="Center"
                                        Margin="0,8,0,0">

                                    <Label Text="{Binding DaysLeft.TotalDays, StringFormat='{0} dagar â€¢ OK'}" 
                                           FontSize="12" 
                                           FontAttributes="Bold"
                                           TextColor="#15803D" 
                                           HorizontalOptions="Center"/>
                                </Border>
                            </Grid>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>
</ContentPage>